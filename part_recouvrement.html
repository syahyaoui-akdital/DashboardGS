<div id="view-recouvrement" class="view-section export-section" data-export-title="Recouvrement & Expédition (Vue Actuelle)">
    <div style="display: flex; height: calc(100vh - 80px); min-height: 800px; border: 1px solid #e1e8f0; border-radius: 12px; overflow: hidden; background: #f8faff;">
        
        <div style="width: 260px; background: white; border-right: 1px solid #e1e8f0; display: flex; flex-direction: column; flex-shrink: 0; z-index: 2;">
            <div style="padding: 25px 20px; border-bottom: 1px solid #f0f0f0; background: linear-gradient(to bottom, #fff, #fbfbfb);">
                <div style="font-size: 0.7em; text-transform: uppercase; color: #363795; font-weight: 800; letter-spacing: 1px; margin-bottom: 15px;">Management</div>
                <div style="margin-bottom: 15px;">
                    <div style="font-size: 0.7em; color: #888; font-weight: 600;">RESP. EXPLOITATION</div>
                    <div id="recouvResp" style="font-size: 0.9em; color: #333; font-weight: 700;">-</div>
                </div>
                <div>
                    <div style="font-size: 0.7em; color: #888; font-weight: 600;">DIR. MÉDICAL</div>
                    <div id="recouvDirMed" style="font-size: 0.9em; color: #333; font-weight: 700;">-</div>
                </div>
            </div>
            
            <div style="padding: 20px; flex-grow: 1; overflow-y: auto;">
                <div style="margin-bottom: 25px;">
                    <div style="font-size: 0.75em; text-transform: uppercase; color: #e67e22; font-weight: 800; margin-bottom: 10px; border-left: 4px solid #e67e22; padding-left: 10px;">Recouvrement</div>
                    <button class="nav-sub-btn active" onclick="switchFamily('Recouvrement', 'Dossiers non réglés', this)">Dossiers non réglés</button>
                    <button class="nav-sub-btn" onclick="switchFamily('Recouvrement', 'Suivi des retours', this)">Suivi des retours</button>
                    <button class="nav-sub-btn" onclick="switchFamily('Recouvrement', 'Objectif vs Réalisation', this)">Objectif vs Réalisation</button>
                    <button class="nav-sub-btn" onclick="switchFamily('Recouvrement', 'Dossiers non soldés', this)">Dossiers non soldés</button>
                </div>

                <div>
                    <div style="font-size: 0.75em; text-transform: uppercase; color: #3498db; font-weight: 800; margin-bottom: 10px; border-left: 4px solid #3498db; padding-left: 10px;">Expédition</div>
                    <button class="nav-sub-btn" onclick="switchFamily('Expédition', 'Dossiers non expédiés', this)">Dossiers non expédiés</button>
                    <button class="nav-sub-btn" onclick="switchFamily('Expédition', 'Objectif vs Réalisation', this)">Objectif vs Réalisation</button>
                </div>
                
                <div style="margin-top: 30px; border-top:1px solid #eee; padding-top:15px;">
                    <button onclick="triggerObjRealImport()" style="width:100%; padding:8px; background:#f0f0f0; border:1px solid #ccc; border-radius:4px; font-size:0.8em; cursor:pointer; color:#555; display:flex; align-items:center; justify-content:center; gap:5px;">
                        <i class="fas fa-sync"></i> Import Objectifs
                    </button>
                </div>
            </div>
        </div>

        <div style="flex-grow: 1; display: flex; flex-direction: column; overflow-y: auto; background: #f8faff; padding: 25px;">
            
            <div style="background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.03); margin-bottom: 20px;">
                 <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                    <div>
                        <h2 id="recouvMainTitle" style="margin: 0; color: #2c3e50; font-size: 1.5em; font-weight: 800; text-transform:uppercase;">RECOUVREMENT</h2>
                        <div id="recouvSubTitle" style="color: #e67e22; font-weight:800; font-size:1em; letter-spacing:0.5px; margin-top:5px;">DOSSIERS NON RÉGLÉS</div>
                        <div id="recouvLastUpdate" style="font-size: 0.8em; color: #7f8c8d; margin-top:4px; font-weight:500;">Date d'actualisation des données : --/--/----</div>
                    </div>
                    
                    <div id="recouvImportZone" style="display: flex; align-items: center; gap: 10px;">
                        <input type="file" id="fileRecouv" accept=".xlsx, .xls" multiple style="display:none;" onchange="handleRecouvFileSelect(event)">
                        <button onclick="document.getElementById('fileRecouv').click()" style="background:linear-gradient(135deg, #e67e22 0%, #d35400 100%); padding:10px 20px; font-size:0.9em; color:white; border:none; border-radius:30px; cursor:pointer; font-weight:600; box-shadow: 0 4px 6px rgba(230, 126, 34, 0.3); transition: all 0.2s;">
                            <i class="fas fa-cloud-upload-alt"></i> Importer Données
                        </button>
                        <span id="fileRecouvDisplay" style="font-size:0.75em; color:#666;"></span>
                    </div>
                </div>
                
                <div id="recouvFilterRow" style="display: flex; gap: 12px; flex-wrap: wrap; align-items: flex-end; padding-top:15px; border-top:1px solid #f0f0f0;">
                    
                    <div class="sec-filter-group">
                        <label>Entité</label>
                        <select id="recouvFilterEntite" onchange="updateRecouvFilters('ENTITE')"></select>
                    </div>
                    
                    <div class="sec-filter-group" id="recouvSubEntityContainer" style="display:none;">
                        <label>Sous-entité</label>
                        <select id="recouvFilterSubEntity" onchange="updateRecouvFilters('SUB')"></select>
                    </div>
                    
                    <div class="sec-filter-group" id="filterPeriodContainer" style="display:none;">
                        <label>Période</label>
                        <select id="objRealFilterPeriod" onchange="updateRecouvDashboard()" style="border-color:#363795; background:#f0f4ff; font-weight:bold;">
                            <option value="ANNUEL">Réalisation Annuelle</option>
                            <option value="TRIMESTRIEL">Réalisation Trimestrielle</option>
                            <option value="MENSUEL" selected>Réalisation Mensuelle</option>
                            <option value="HEBDOMADAIRE">Réalisation Hebdomadaire</option>
                            <option value="JOURNALIER">Réalisation Journalière</option>
                        </select>
                    </div>

                    <div class="sec-filter-group" id="filterAnneeContainer"><label>Année</label><select id="recouvFilterAnnee" onchange="updateRecouvFilters('ANNEE')"></select></div>
                    <div class="sec-filter-group" id="filterTrimContainer"><label>Trimestre</label><select id="recouvFilterTrim" onchange="updateRecouvFilters('TRIM')"><option value="">TOUT</option><option value="T1">T1</option><option value="T2">T2</option><option value="T3">T3</option><option value="T4">T4</option></select></div>
                    <div class="sec-filter-group" id="filterMoisContainer"><label>Mois</label><select id="recouvFilterMois" onchange="updateRecouvFilters('MOIS')"></select></div>
                    
                    <div class="sec-filter-group" id="filterOrganismeContainer"><label>Organisme</label><select id="recouvFilterOrganisme" onchange="updateRecouvFilters('ORG')" style="max-width:150px;"></select></div>
                    <div class="sec-filter-group" id="filterMotifContainer" style="display:none;"><label>Motif STD</label><select id="recouvFilterMotif" onchange="updateRecouvDashboard()" style="max-width:130px;"></select></div>
                    <div class="sec-filter-group" id="filterEtatContainer" style="display:none;"><label>État Dossier</label><select id="recouvFilterEtat" onchange="updateRecouvDashboard()" style="max-width:130px;"></select></div>
                    
                    <div class="sec-filter-group" id="filterStatutContainer">
                        <label>Statut</label>
                        <select id="recouvFilterEcheance" onchange="updateRecouvFilters('STATUT')" style="background:#f0f8ff; border-color:#3498db;">
                            <option value="">TOUT</option>
                            <option value="ECHUE">Factures Échues</option>
                            <option value="NON_ECHUE">Factures Non Échues</option>
                        </select>
                    </div>

                    <div class="sec-filter-group" id="filterApprocheContainer" style="display:none;"><label>Approche</label><select id="expedFilterApproche" onchange="updateRecouvDashboard()"><option value="SORTIE">Date Sortie</option><option value="PEC">Date PEC</option></select></div>
                    <div class="sec-filter-group" id="filterPatientContainer" style="display:none;"><label>Patient</label><select id="expedFilterPatient" onchange="updateRecouvDashboard()"><option value="">TOUT</option><option value="SORTANT">Patient Sortant</option><option value="HOSPITALISE">Hospitalisé</option></select></div>
                </div>
            </div>

            <div id="recouvDataContent">
                <div id="recouvKPIs" class="export-section cards-row" data-export-title="Recouv. - Indicateurs" style="display:grid; grid-template-columns: repeat(4, 1fr); gap:20px; margin-bottom:25px;">
                    <div class="stat-card" style="border-top: 4px solid #e67e22; cursor:pointer;" onclick="showRecouvDetail(currentFilteredDataGlobal, 'Détail Global')">
                        <div class="stat-title">MONTANT TOTAL</div>
                        <div id="kpiRecouvMontant" class="stat-value" style="color: #d35400;">--</div>
                        <div class="stat-sub">Volumétrie : <span id="kpiRecouvCount" style="font-weight:bold;">--</span></div>
                    </div>
                    <div class="stat-card" style="border-top: 4px solid #f1c40f; cursor:default;">
                        <div id="kpiCard2Title" class="stat-title">TOP 3 ENTITÉS</div>
                        <div id="kpiRecouvTopEntities" style="margin-top:10px; font-size:0.85em;"></div>
                    </div>
                    <div class="stat-card" style="border-top: 4px solid #9b59b6; cursor:default;">
                        <div id="kpiCard3Title" class="stat-title">TOP 3 ORGANISMES</div>
                        <div id="kpiRecouvTopOrgList" style="margin-top:10px; font-size:0.85em;"></div>
                    </div>
                    <div id="cardVariable" class="stat-card alert-card" style="border-top: 4px solid #3498db; cursor:pointer; position: relative; overflow: hidden;" onclick="handleVariableCardClick()">
                        <div style="position: relative; z-index: 2;">
                            <div id="kpiCard4Title" class="stat-title" style="color:#2c3e50;">--</div>
                            <div id="kpiCard4Value" style="margin-top:5px;"></div>
                            <div id="kpiCard4Action" style="margin-top:10px;"></div>
                        </div>
                        <i id="bgIconVariable" class="fas" style="position: absolute; right: -10px; bottom: -15px; font-size: 6em; opacity: 0.1; z-index: 1;"></i>
                    </div>
                </div>

                <div id="rowAlertsRecouv" class="export-section" data-export-title="Recouv. - Alertes Factures" style="display:flex; gap:20px; margin-bottom:25px;">
                    <div class="stat-card" style="flex:1; border-top: 4px solid #c0392b; background:#fff5f5; padding:20px; cursor:pointer;" onclick="openRecouvDetail('ECHUE')">
                        <div style="display:flex; justify-content:space-between; align-items:center;">
                            <div>
                                <div class="stat-title" style="color:#c0392b;">FACTURES ÉCHUES</div>
                                <div id="kpiEchueMontant" class="stat-value" style="color:#c0392b; font-size:1.8em;">--</div>
                                <div style="color:#a93226; font-size:0.9em; font-weight:600;">Nombre : <span id="kpiEchueCount">--</span></div>
                            </div>
                            <div style="font-size:3em; opacity:0.1; color:#c0392b;">⚠️</div>
                        </div>
                    </div>
                    <div class="stat-card" style="flex:1; border-top: 4px solid #27ae60; background:#f0fbf4; padding:20px; cursor:pointer;" onclick="openRecouvDetail('NON_ECHUE')">
                        <div style="display:flex; justify-content:space-between; align-items:center;">
                            <div>
                                <div class="stat-title" style="color:#27ae60;">FACTURES NON ÉCHUES</div>
                                <div id="kpiNonEchueMontant" class="stat-value" style="color:#27ae60; font-size:1.8em;">--</div>
                                <div style="color:#1e8449; font-size:0.9em; font-weight:600;">Nombre : <span id="kpiNonEchueCount">--</span></div>
                            </div>
                            <div style="font-size:3em; opacity:0.1; color:#27ae60;">✅</div>
                        </div>
                    </div>
                </div>

                <div id="rowAlertsExped" style="display:none; grid-template-columns: repeat(4, 1fr); gap:20px; margin-bottom:25px;">
                    <div class="stat-card" style="border-top:4px solid #2ecc71; background:#f0fbf4; cursor:pointer;" onclick="openRecouvDetail('30')"><div class="stat-title" style="color:#27ae60">< 30 Jours</div><div id="kpiExped30_Mt" class="stat-value" style="font-size:1.4em;">--</div><div style="font-size:0.8em;">Nb: <span id="kpiExped30_Nb" style="font-weight:bold;">--</span></div></div>
                    <div class="stat-card" style="border-top:4px solid #f1c40f; cursor:pointer;" onclick="openRecouvDetail('60')"><div class="stat-title" style="color:#f39c12">30 - 60 Jours</div><div id="kpiExped60_Mt" class="stat-value" style="font-size:1.4em;">--</div><div style="font-size:0.8em;">Nb: <span id="kpiExped60_Nb" style="font-weight:bold;">--</span></div></div>
                    <div class="stat-card" style="border-top:4px solid #e67e22; cursor:pointer;" onclick="openRecouvDetail('90')"><div class="stat-title" style="color:#d35400">60 - 90 Jours</div><div id="kpiExped90_Mt" class="stat-value" style="font-size:1.4em;">--</div><div style="font-size:0.8em;">Nb: <span id="kpiExped90_Nb" style="font-weight:bold;">--</span></div></div>
                    <div class="stat-card" style="border-top:4px solid #c0392b; background:#fff5f5; cursor:pointer;" onclick="openRecouvDetail('SUP')"><div class="stat-title" style="color:#c0392b">> 90 Jours</div><div id="kpiExpedSup_Mt" class="stat-value" style="font-size:1.4em;">--</div><div style="font-size:0.8em;">Nb: <span id="kpiExpedSup_Nb" style="font-weight:bold;">--</span></div></div>
                </div>

                <div id="recouvChartBlock" class="export-section chart-container" data-export-title="Recouv. - Graphique Évolution" style="background: white; border-radius: 12px; padding: 25px; box-shadow: 0 2px 10px rgba(0,0,0,0.03); margin-bottom: 25px; height: 400px;">
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                        <h4 id="chartTitleHisto" style="margin:0; color:#333; font-weight:700;">Evolution des montants</h4>
                        <div style="background:#f4f6f8; border-radius:20px; padding:3px; display:flex; gap:2px;">
                            <button onclick="updateRecouvGraphMode('TIME')" class="toggle-chart-btn active" id="btnRecGraphTime">Période</button>
                            <button onclick="updateRecouvGraphMode('ENTITY')" class="toggle-chart-btn" id="btnRecGraphEntity">Entité</button>
                            <button onclick="updateRecouvGraphMode('ORG')" class="toggle-chart-btn" id="btnRecGraphOrg">Organisme</button>
                        </div>
                    </div>
                    <div style="height:330px; width: 100%; overflow: hidden;"><canvas id="chartRecouvSimple"></canvas></div>
                </div>

                <div style="display:flex; gap:20px; margin-bottom:20px; height: 450px;">
                    <div class="table-container" id="blockClassifOrg" style="flex:1; background:white; border-radius:12px; overflow:hidden; box-shadow:0 2px 10px rgba(0,0,0,0.03); display:flex; flex-direction:column;">
                        <div style="padding:15px; background:#f8faff; border-bottom:1px solid #eee; display:flex; justify-content:space-between;">
                            <h4 style="margin:0; color:#363795; font-size:0.95em; font-weight:700;">Par Organisme</h4>
                        </div>
                        <div style="flex:1; overflow-y:auto;">
                            <table id="tableRecouvOrg" style="width:100%; border-collapse:collapse; font-size:0.85em;">
                                <thead style="position:sticky; top:0; background:#fff; z-index:5;">
                                    <tr>
                                        <th style="text-align:left; cursor:pointer;">Nom</th>
                                        <th style="text-align:center; cursor:pointer;">Nbr</th>
                                        <th style="text-align:right; cursor:pointer;">Montant</th>
                                        <th style="text-align:right;">%</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                    <div id="recouvPieBlock" class="export-section chart-container" data-export-title="Recouv. - Répartition" style="flex:1; background:white; padding:20px; border-radius:12px; box-shadow:0 2px 10px rgba(0,0,0,0.03);">
                        <h4 style="text-align:center; margin:0 0 20px 0; color:#555; font-weight:700;">Répartition par Organisme</h4>
                        <div style="height:350px;"><canvas id="chartRecouvPie"></canvas></div>
                    </div>
                </div>
                
                <div id="blockClassifNature" style="display:none; gap:20px; margin-bottom:20px; height: 450px;">
                     <div class="table-container" style="flex:1; background:white; border-radius:12px; overflow:hidden; box-shadow:0 2px 10px rgba(0,0,0,0.03); display:flex; flex-direction:column;">
                        <h4 style="padding:15px; margin:0; background:#f8faff; border-bottom:1px solid #eee; color:#363795; font-size:0.95em; font-weight:700;">Par Nature</h4>
                        <div style="flex:1; overflow-y:auto;">
                            <table id="tableRecouvNature" style="width:100%; border-collapse:collapse; font-size:0.85em;">
                                <thead style="position:sticky; top:0; background:#fff; z-index:5;">
                                    <tr>
                                        <th style="text-align:left; cursor:pointer;">Nature</th>
                                        <th style="text-align:center; cursor:pointer;">Nbr</th>
                                        <th style="text-align:right; cursor:pointer;">Montant</th>
                                        <th style="text-align:right;">%</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                    <div class="chart-container" style="flex:1; background:white; padding:20px; border-radius:12px; box-shadow:0 2px 10px rgba(0,0,0,0.03);">
                        <h4 style="text-align:center; margin:0 0 20px 0; color:#555; font-weight:700;">Répartition par Nature</h4>
                        <div style="height:350px;"><canvas id="chartNaturePie"></canvas></div>
                    </div>
                </div>

                <div id="recouvTopTable" class="export-section table-container" data-export-title="Recouv. - Top Factures / Balance" style="background:white; border-radius:12px; overflow:hidden; box-shadow:0 2px 10px rgba(0,0,0,0.03); margin-bottom:30px; display:flex; flex-direction:column; min-height: 500px;">
                    <div style="padding:15px; background:#fff5f5; border-bottom:1px solid #eee; display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; gap:10px;">
                        
                        <div style="display:flex; gap:15px; align-items:center;">
                            <div style="display:flex; gap:5px;">
                                <button id="btnViewList" onclick="updateRecouvViewMode('LIST')" style="border:none; background:#c0392b; color:white; padding:5px 12px; border-radius:15px; cursor:pointer; font-weight:bold; font-size:0.85em;">Liste Factures</button>
                                <button id="btnViewBalance" onclick="updateRecouvViewMode('BALANCE')" style="border:none; background:transparent; color:#666; padding:5px 12px; border-radius:15px; cursor:pointer; font-weight:bold; font-size:0.85em;">Balance</button>
                            </div>

                            <div id="balanceOptions" style="display:none; background:white; border:1px solid #ddd; border-radius:20px; padding:2px;">
                                <button id="btnBalAge" onclick="updateRecouvBalanceMode('AGEING')" style="border:none; background:#363795; color:white; padding:4px 12px; border-radius:18px; cursor:pointer; font-size:0.8em; font-weight:600;">Antériorité</button>
                                <button id="btnBalPer" onclick="updateRecouvBalanceMode('PERIOD')" style="border:none; background:transparent; color:#666; padding:4px 12px; border-radius:18px; cursor:pointer; font-size:0.8em; font-weight:600;">Période</button>
                            </div>
                        </div>

                        <h4 id="tableMainTitle" style="margin:0; color:#c0392b; text-align:center;">TOP FACTURES</h4>

                        <div style="font-size:0.8em; display:flex; gap:10px; align-items:center;">
                            <div id="sortListContainer" style="display:flex; align-items:center; gap:5px; border-right:1px solid #ddd; padding-right:10px; margin-right:5px;">
                                <span style="color:#666;">Trier par:</span>
                                <select id="recouvSortSelect" onchange="updateRecouvSort(this.value)" style="padding:4px 8px; border-radius:15px; border:1px solid #ddd; font-size:0.9em; cursor:pointer; font-weight:600; color:#363795;">
                                    <option value="MONTANT">Montant</option>
                                    <option value="DELAI">Délai / Ancienneté</option>
                                </select>
                            </div>

                            <div style="display:flex; gap:5px; margin-right: 15px;">
                                <button onclick="exportTop25Excel()" style="background:none; border:none; color:#27ae60; cursor:pointer; font-size:1.4em;" title="Exporter Excel"><i class="fas fa-file-excel"></i></button>
                                <button onclick="printTop25PDF()" style="background:none; border:none; color:#c0392b; cursor:pointer; font-size:1.4em;" title="Exporter PDF"><i class="fas fa-file-pdf"></i></button>
                            </div>

                            <div id="topNSelector" style="display:flex; align-items:center; gap:5px; border-left:1px solid #ddd; padding-left:10px;">
                                <span style="color:#666;">Top:</span>
                                <select id="recouvTopN" onchange="updateRecouvTopN(this.value)" style="padding:4px 8px; border-radius:15px; border:1px solid #ddd; font-size:0.9em; cursor:pointer;">
                                    <option value="10">10</option>
                                    <option value="25" selected>25</option>
                                    <option value="50">50</option>
                                    <option value="1000">Tout</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div id="viewListContainer" style="flex:1; overflow-y:auto; height: 450px;">
                        <table id="tableTopFactures" style="width:100%; border-collapse:collapse; font-size:0.85em;">
                            <thead style="position:sticky; top:0; background:#fff; z-index:5;">
                                <tr id="headerRowTop25"></tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>

                    <div id="viewBalanceContainer" style="flex:1; overflow-y:auto; height: 450px; display:none;">
                        <table id="tableBalanceAgee" style="width:100%; border-collapse:collapse; font-size:0.85em;">
                            <thead style="position:sticky; top:0; background:#fff; z-index:5;">
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div id="objRealDataContent" style="display:none;">
                <style>
                  .obj-wrapper { display: flex; flex-direction: column; gap: 20px; font-family: 'Segoe UI', sans-serif; }
                  .obj-kpi-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; }
                  .obj-card {
                    background: white; border-radius: 12px; padding: 15px;
                    box-shadow: 0 4px 15px rgba(0,0,0,0.05); border: 1px solid #e1e8f0;
                    position: relative; overflow: hidden;
                  }
                  .obj-card::after {
                    content: ""; position: absolute; right: -20px; top: -20px;
                    width: 80px; height: 80px; border-radius: 50%;
                    background: rgba(0,0,0,0.03);
                  }
                  .obj-card.blue { border-left: 4px solid #2E90FA; }
                  .obj-card.green { border-left: 4px solid #10B981; }
                  .obj-card.orange { border-left: 4px solid #F59E0B; }
                  .obj-card.purple { border-left: 4px solid #8B5CF6; }

                  .obj-head { display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px; }
                  .obj-lbl { font-size: 0.75em; font-weight: 800; text-transform: uppercase; color: #64748B; letter-spacing: 0.5px; }
                  .obj-val { font-size: 1.8em; font-weight: 800; color: #0F172A; }
                  .obj-sub { font-size: 0.8em; color: #94A3B8; font-weight: 600; margin-top: 5px; }
                  
                  .prog-track { width: 100%; height: 6px; background: #f1f5f9; border-radius: 10px; margin-top: 10px; overflow: hidden; }
                  .prog-fill { height: 100%; border-radius: 10px; transition: width 0.5s ease; }

                  .obj-split { display: grid; grid-template-columns: 2fr 1fr; gap: 20px; min-height: 400px; }
                  .obj-box { background: white; border-radius: 12px; padding: 20px; border: 1px solid #e1e8f0; box-shadow: 0 2px 10px rgba(0,0,0,0.03); }
                  .obj-title { font-weight: 800; color: #334155; text-transform: uppercase; font-size: 0.85em; margin-bottom: 15px; display:flex; justify-content:space-between; }
                  
                  .perf-table { width: 100%; border-collapse: collapse; font-size: 0.85em; }
                  .perf-table th { text-align: left; color: #64748B; padding: 8px; border-bottom: 2px solid #eee; font-weight: 700; text-transform: uppercase; font-size: 0.8em; }
                  .perf-table td { padding: 10px 8px; border-bottom: 1px solid #f1f5f9; color: #333; font-weight: 600; }
                  .perf-table tr:last-child td { border-bottom: none; }
                  .badge-perf { padding: 3px 8px; border-radius: 12px; font-size: 0.85em; }
                  .badge-perf.good { background: #dcfce7; color: #166534; }
                  .badge-perf.bad { background: #fee2e2; color: #991b1b; }
                  .badge-perf.mid { background: #fef3c7; color: #92400e; }

                  .back-btn { cursor:pointer; font-size:0.8em; color:#363795; background:#eef2ff; padding:4px 10px; border-radius:15px; display:none; align-items:center; gap:5px; border:none; font-weight:700; }
                  .back-btn:hover { background:#e0e7ff; }

                  /* Styles boutons tableau */
                  .toggle-btn { 
                      background: none; 
                      border: none; 
                      padding: 4px 12px; 
                      border-radius: 6px; 
                      cursor: pointer; 
                      font-size: 0.75em; 
                      color: #64748B; 
                      font-weight: 600; 
                      transition: all 0.2s; 
                  }
                  .toggle-btn:hover { background: #e2e8f0; }
                  .toggle-btn.active { 
                      background: #fff; 
                      color: #363795; 
                      box-shadow: 0 1px 2px rgba(0,0,0,0.1); 
                      font-weight: 700;
                  }

                  @media (max-width: 1200px) { .obj-split { grid-template-columns: 1fr; } .obj-kpi-grid { grid-template-columns: 1fr 1fr; } }
                </style>

                <div class="obj-wrapper">
                    
                    <div class="obj-kpi-grid">
                        <div class="obj-card blue">
                            <div class="obj-head"><span class="obj-lbl">Objectif Total</span><i class="fas fa-bullseye" style="color:#BFD4F5"></i></div>
                            <div class="obj-val" id="kpiObjVal">--</div>
                            <div class="obj-sub">Défini pour la période</div>
                        </div>
                        <div class="obj-card green">
                            <div class="obj-head"><span class="obj-lbl">Réalisation</span><i class="fas fa-coins" style="color:#A7F3D0"></i></div>
                            <div class="obj-val" id="kpiRealVal">--</div>
                            <div class="obj-sub" id="kpiRealGap">--</div>
                        </div>
                        <div class="obj-card orange">
                            <div class="obj-head"><span class="obj-lbl">Taux d'Atteinte</span><i class="fas fa-chart-line" style="color:#FDE68A"></i></div>
                            <div class="obj-val" id="kpiRateVal">--%</div>
                            <div class="prog-track"><div class="prog-fill" id="kpiRateBar" style="width:0%; background:#F59E0B;"></div></div>
                        </div>
                        <div class="obj-card purple">
                            <div class="obj-head"><span class="obj-lbl">Projection Fin de Mois</span><i class="fas fa-hourglass-half" style="color:#DDD6FE"></i></div>
                            <div class="obj-val" id="kpiProjVal">--</div>
                            <div class="obj-sub" id="kpiProjSub">Basé sur tendance</div>
                        </div>
                    </div>

                    <div class="obj-split">
                        <div class="obj-box">
                            <div class="obj-title">
                                <span id="chartObjTitle">Évolution Temporelle</span>
                                <button id="btnBackToMonth" class="back-btn" onclick="resetObjZoom()">
                                    <i class="fas fa-arrow-left"></i> Retour
                                </button>
                            </div>
                            <div style="height: 320px; position:relative;">
                                <canvas id="chartObjMain"></canvas>
                            </div>
                        </div>

                        <div class="obj-box">
                            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                                <div class="obj-title" style="margin:0;">Performance</div>
                                <div style="background:#f1f5f9; padding:3px; border-radius:8px; display:flex; gap:2px;">
                                    <button id="btnTblEnt" onclick="setObjTableMode('ENTITY')" class="toggle-btn active">Par Entité</button>
                                    <button id="btnTblPer" onclick="setObjTableMode('PERIOD')" class="toggle-btn">Comparatif</button>
                                    <button id="btnTblOrg" onclick="setObjTableMode('ORG')" class="toggle-btn">Par Organisme</button>
                                </div>
                            </div>
                            
                            <div id="objTableContainer" style="overflow-y:auto; max-height:320px;">
                                <table class="perf-table" id="tableObjPerf">
                                    <thead></thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
            
            <div id="recouvDetailModal" style="display:none; position:fixed; z-index:9999; left:0; top:0; width:100%; height:100%; background-color:rgba(0,0,0,0.5); backdrop-filter:blur(2px);">
                <div style="background-color:#fff; margin:2% auto; border-radius:10px; width:95%; max-width:1400px; height:90vh; display:flex; flex-direction:column; box-shadow:0 10px 25px rgba(0,0,0,0.2);">
                    <div style="padding:15px 20px; background:#363795; color:white; border-radius:10px 10px 0 0; display:flex; justify-content:space-between; align-items:center;">
                        <h3 id="recouvModalTitle" style="margin:0;">Détail</h3>
                        <div style="display:flex; gap:15px; align-items:center;">
                            <button onclick="exportRecouvExcel()" style="background:transparent; border:none; color:white; font-size:1.5em; cursor:pointer;" title="Exporter Excel"><i class="fas fa-file-excel"></i></button>
                            <button onclick="printRecouvData()" style="background:transparent; border:none; color:white; font-size:1.5em; cursor:pointer;" title="Imprimer"><i class="fas fa-print"></i></button>
                            <span onclick="closeRecouvModal()" style="cursor:pointer; font-size:2em; margin-left:10px;">&times;</span>
                        </div>
                    </div>
                    <div id="recouvPrintArea" style="flex:1; overflow-y:auto; padding:0; position:relative;">
                        <table class="detail-table" id="recouvExportTable" style="width:100%; border-collapse:collapse; font-size:0.85em;">
                            <tbody id="recouvTableBody"></tbody>
                        </table>
                    </div>
                    <div style="padding:15px; border-top:1px solid #eee; background:#f4f6f9; display:flex; justify-content:space-between; align-items:center; border-radius:0 0 10px 10px;">
                        <div style="display:flex; gap:20px; align-items:center;">
                            <div style="font-weight:700; color:#555;">SÉLECTION :</div>
                            <div style="background:#e67e22; color:white; padding:5px 15px; border-radius:20px; font-weight:bold; font-size:0.95em;"><i class="fas fa-file-invoice"></i> <span id="recouvDetailCount">0</span> Dossiers</div>
                            <div style="background:#363795; color:white; padding:5px 15px; border-radius:20px; font-weight:bold; font-size:0.95em;"><i class="fas fa-coins"></i> <span id="recouvDetailTotal">0 DH</span></div>
                        </div>
                        <button onclick="closeRecouvModal()" style="padding:8px 30px; background:#555; color:white; border:none; border-radius:4px; cursor:pointer; font-weight:600;">Fermer</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .nav-sub-btn { display:block; width:100%; text-align:left; padding:10px 15px; background:none; border:none; border-left:3px solid transparent; color:#666; cursor:pointer; font-size:0.85em; transition:0.2s; }
    .nav-sub-btn:hover { background:#f9f9f9; color:#363795; }
    .nav-sub-btn.active { background:#f0f4ff; color:#363795; border-left-color:#363795; font-weight:700; }
    .sec-filter-group label { display:block; font-size:0.75em; color:#888; margin-bottom:3px; }
    .sec-filter-group select { padding:6px; border:1px solid #ddd; border-radius:4px; font-size:0.9em; min-width:90px; }
    #tableTopFactures th, #tableRecouvOrg th, #tableBalanceAgee th, .detail-table th { background:#fcfcfc; padding:10px; color:#666; font-weight:600; border-bottom:2px solid #eee; user-select:none; }
    #tableTopFactures td, #tableRecouvOrg td, #tableBalanceAgee td, .detail-table td { padding:8px 10px; border-bottom:1px solid #eee; }
    .sort-btn { background:white; border:1px solid #c0392b; color:#c0392b; padding:2px 8px; border-radius:12px; cursor:pointer; font-size:0.9em; font-weight:bold; transition:0.2s; }
    .sort-btn:hover { background:#f9e7e7; }
    .sort-btn.active { background:#c0392b; color:white; }
    .detail-table thead th, #tableBalanceAgee thead th { position: sticky; top: 0; z-index: 10; box-shadow: 0 1px 2px rgba(0,0,0,0.1); }
</style>